function merge(e,t){if(isNull(e)^isNull(t))return isNull(e)?t:e;var n={};var r=e;var s=t;for(i in r){if(typeof s[i]!="undefined"){if(typeof r[i]=="object"&&typeof s[i]=="object"){delete n[i];var o=i;var u=merge(r[i],s[i]);i=o;n[i]=u}else{n[i]=s[i]}delete s[i]}else n[i]=r[i]}for(i in s)n[i]=s[i];return n}function contains(e,t){for(var n=0;n<e.length;n++){if(e[n]===t){return true}}return false}function isNull(e){return e===false||typeof e=="undefined"}function LOG(e){if(DEBUG==true){console.log(arguments)}}function CanvasLoading(e,t){if(!(t&&typeof t=="object"))t=false;this.element=document.querySelector(e);this.options=merge(this.default,t);this.type=this.getType();this.loop=false;this.effect=this.getLoadingEffect();this.begin=this.getBegin();this.end=this.getEnd();this.progress=0;this.init()}function CircleEffect(){this.config={startAngle:3/2*Math.PI,roundTime:2500,withStrokeEffect:false,counterclockwise:true,fill:false};var e;CircleEffect.prototype.init=function(t){e=this;this.object=t;this.config=merge(this.config,this.object.options);this.context=t.context2D};CircleEffect.prototype.resizeCanvas=function(e){};CircleEffect.prototype.paint=function(e){e.fillStyle=this.object.options.clear;e.fillRect(0,0,this.object.canvas.width,this.object.canvas.height);if(this.object.options.standAlone)this.setNextProgress();if(this.config.counterclockwise){if(this.getProgress()<=.5){var t=this.config.startAngle;var n=t-this.object.getProgress()*4*Math.PI}else{var n=this.config.startAngle;var t=n-this.object.getProgress()*4*Math.PI}}else{if(this.getProgress()<=.5){var n=this.config.startAngle;var t=n+this.object.getProgress()*4*Math.PI}else{var t=this.config.startAngle;var n=t+this.object.getProgress()*4*Math.PI}}e.lineWidth=this.object.options.weight*(this.config.withStrokeEffect==true?this.getProgress()>.5?1-this.getProgress():this.getProgress():1);e.beginPath();e.arc(this.object.options.width/2,this.object.options.height/2,this.object.options.radius,0,2*Math.PI);e.strokeStyle=this.object.options.backColor;e.stroke();e.beginPath();e.arc(this.object.options.width/2,this.object.options.height/2,this.object.options.radius,t,n,true);if(this.config.fill==false){e.strokeStyle="#333";e.stroke()}else{e.fillStyle="#ccc";e.fill()}};CircleEffect.prototype.getNextProgress=function(){return this.getProgress()+CanvasLoading.config.rate/this.config.roundTime*2};CircleEffect.prototype.setNextProgress=function(){this.setProgress(this.getNextProgress())};CircleEffect.prototype.setAndGetNextProgress=function(){this.setNextProgress();return this.getProgress()};CircleEffect.prototype.setProgress=function(e){if(e>1)e=0;this.object.setProgress(e)};CircleEffect.prototype.getProgress=function(){return this.object.getProgress()}}function RectangleEffect(){RectangleEffect.prototype.init=function(e){};RectangleEffect.prototype.resizeCanvas=function(e){};RectangleEffect.prototype.paint=function(e){}}function FullpageEffect(){this.config={position:{type:"fixed",top:0,left:0,right:0,bottom:"auto"}};var e;FullpageEffect.prototype.init=function(t){e=this;this.object=t;this.config=merge(this.config,this.object.options);t.element.style.position=this.config.position.type;t.element.style.top=this.config.position.top;t.element.style.left=this.config.position.left;t.element.style.right=this.config.position.right;t.element.style.bottom=this.config.position.bottom;t.element.style.width=this.config.width;t.element.style.height=this.config.height;t.element.removeChild(t.element.getElementsByTagName("span")[0])};FullpageEffect.prototype.resizeCanvas=function(t){var n=window.innerWidth;e.object.canvas.width=n;e.object.options.width=n};FullpageEffect.prototype.paint=function(e){e.clearRect(0,0,parseFloat(this.object.options.width),parseFloat(this.object.options.height));this.setNextProgress();e.beginPath();e.fillStyle=this.object.options.backColor;e.rect(0,0,parseFloat(this.object.options.width),parseFloat(this.object.options.height));e.closePath();e.fill();var t,n,r,i;if(this.getProgress()<1){t=0;n=0;r=this.object.options.width*this.getProgress();i=this.object.options.height}else{t=this.object.options.width*(this.getProgress()-1);n=0;r=this.object.options.width*(1-(this.getProgress()-1));i=this.object.options.height}e.beginPath();e.fillStyle=this.object.options.frontColor;e.rect(t,n,parseFloat(r),parseFloat(i));e.closePath();e.fill()};FullpageEffect.prototype.begin=function(){LOG("Loading Fullscreen va commencer!!")};FullpageEffect.prototype.end=function(){LOG("Loading Fullscreen va s'arrÃªter!!")};FullpageEffect.prototype.getNextProgress=function(){return this.object.getNextProgress(true)};FullpageEffect.prototype.setNextProgress=function(){if(!this.object.options.standAlone)this.setProgress(this.getNextProgress());else this.setProgress(this.getProgress()+CanvasLoading.config.rate/(this.object.options.animationTime*5))};FullpageEffect.prototype.setAndGetNextProgress=function(){this.setNextProgress();return this.getProgress()};FullpageEffect.prototype.setProgress=function(e){if(e>2){e=0}this.object.setProgress(e)};FullpageEffect.prototype.getProgress=function(){return this.object.getProgress()}}var DEBUG=false;window.onkeydown=function(e){if(e.keyCode==68){DEBUG=!DEBUG;console.log("MODE DEBUG IS "+(DEBUG?"ON":"OFF"))}};CanvasLoading.config={prefix:"cnvldg",delimiterPrefix:"-",rate:15,animationrate:5};CanvasLoading.prototype.default={standAlone:true,radius:15,longer:10,weight:5,animationStart:true,animationEnd:true,animationTime:200,duration:false,width:50,height:50,clear:"#fff",backColor:"#eee",frontColor:"#333"};CanvasLoading.TypesEffect={CIRCLE:"CIRCLE",RECTANGLE:"RECTANGLE",FULLPAGE:"FULLPAGE"};CanvasLoading.prototype.init=function(){this.canvas=document.createElement("canvas");this.canvas.className=CanvasLoading.config.prefix;this.canvas.width=this.options.width;this.canvas.height=this.options.height;this.title=this.element.innerHTML;var e=document.createElement("span");e.className=CanvasLoading.config.prefix+CanvasLoading.config.delimiterPrefix+"title";e.innerHTML=this.title;this.element.innerHTML="";this.element.appendChild(this.canvas);this.element.appendChild(e);this.context2D=this.canvas.getContext("2d");this.effect.init(this);window.onresize=this.effect.resizeCanvas;window.onload=this.effect.resizeCanvas};CanvasLoading.prototype.setOption=function(e,t){var n;if(typeof e=="string"){n={};var r=t||null;var i=e.toString();n[i]=r}else if(typeof e=="object"){n=e}this.options=merge(this.options,n)};CanvasLoading.prototype.show=function(e){var t;var n=this;var r=false;this.startTime=(new Date).getTime();if(e&&typeof e=="number"){if(e>this.options.animationTime&&this.options.standAlone){e=Math.abs(parseInt(e));this.options.duration=e;setTimeout(function(){if(n.startTime==n.getStartTime())n.hide()},e)}else if(e<n.options.animationTime){r=true}}if(this.options.animationStart===true){t=this.element;t.style.opacity=t.style.opacity||0;this.start();var i=setInterval(function(){if(parseFloat(t.style.opacity)<1){t.style.opacity=parseFloat(t.style.opacity)+1/(n.options.animationTime/CanvasLoading.config.animationrate)}else{t.style.opacity=1;clearInterval(i);if(r===true)n.hide()}},CanvasLoading.config.animationrate)}};CanvasLoading.prototype.hide=function(){var e;var t=this;if(this.options.animationEnd===true){e=t.element;e.style.opacity=e.style.opacity||1;var n=setInterval(function(){if(parseFloat(e.style.opacity)>=.05){e.style.opacity=parseFloat(e.style.opacity)-1/(t.options.animationTime/CanvasLoading.config.animationrate)}else{e.style.opacity=0;clearInterval(n);t.stop()}},CanvasLoading.config.animationrate)}};CanvasLoading.prototype.start=function(){var e=this;this.stop();this.launchBegin();this.loop=setInterval(function(){e.paint()},CanvasLoading.config.rate)};CanvasLoading.prototype.stop=function(){if(this.loop!==false){clearInterval(this.loop);this.launchEnd()}};CanvasLoading.prototype.paint=function(){this.effect.paint(this.context2D)};CanvasLoading.prototype.getType=function(){var e=this.element.className.split(" ");var t;for(i in e){var n=e[i].search(CanvasLoading.config.prefix+CanvasLoading.config.delimiterPrefix);if(n>-1){t=e[i].substring((CanvasLoading.config.prefix+CanvasLoading.config.delimiterPrefix).length).toUpperCase();var r=false;for(var s in CanvasLoading.TypesEffect){if(CanvasLoading.TypesEffect[s]===t){r=true;break}}if(r===false)break;delete e[i];if(e.length==0)this.element.removeAttribute("class");else this.element.className=e.join(" ").trim();return t}}throw new Error("No type canvas loading effect found : "+t+". Please read documentation.")};CanvasLoading.prototype.getLoadingEffect=function(){switch(this.type){case CanvasLoading.TypesEffect.CIRCLE:return new CircleEffect;break;case CanvasLoading.TypesEffect.RECTANGLE:return new RectangleEffect;break;case CanvasLoading.TypesEffect.FULLPAGE:return new FullpageEffect;break}};CanvasLoading.prototype.getNextProgress=function(e){if(this.options.standAlone){if(typeof this.effect.getNextProgress!="undefined"&&this.options.duration===false&&typeof e!="undefined"&&!e)return this.effect.getNextProgress();else return((new Date).getTime()-this.startTime)/(this.options.duration||this.options.animationTime*10)}else return this.getProgress()};CanvasLoading.prototype.setAndGetNextProgress=function(){this.setProgress(this.getNextProgress());return this.getProgress()};CanvasLoading.prototype.setProgress=function(e,t){if(this.options.standAlone===true||typeof t!="undefined"&&t===true){if(this.progress!=e)this.progress=e}else if(this.options.standAlone===false){var n=e-this.getProgress();var r=this;var i=setInterval(function(){if(n>0&&r.getProgress()<=e||n<0&&r.getProgress()>=e){r.setProgress(r.getProgress()+n/(r.options.animationTime/CanvasLoading.config.rate),true)}else{r.setProgress(e,true);clearInterval(i)}},CanvasLoading.config.rate)}};CanvasLoading.prototype.getProgress=function(){return this.progress};CanvasLoading.prototype.getStartTime=function(){return this.startTime};CanvasLoading.prototype.getBegin=function(){return typeof this.effect.begin!="undefined"?this.effect.begin:false};CanvasLoading.prototype.getEnd=function(){return typeof this.effect.end!="undefined"?this.effect.end:false};CanvasLoading.prototype.launchBegin=function(){if(this.begin!==false)this.begin()};CanvasLoading.prototype.launchEnd=function(){if(this.end!==false)this.end()};CanvasLoading.prototype.launchEnd=function(){if(this.end!==false)this.end()};CanvasLoading.prototype.changeStandAloneState=function(e){this.options.standAlone=e;this.show()}
